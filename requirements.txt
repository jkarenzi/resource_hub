flask
pymysql (for making a connection to the database)


#a route that handles search functionality. it queries the db based on the search keyword provided
@app.route('/search', methods=['POST'])
def search():
    username = session.get('username')
    query = request.form.get('query', []).lower()
    connection = pymysql.connect(
            host='54.82.71.184',
            user='karenzi',
            password='@Karenzijoslyn46',
            database='posts'
        )

    cursor = connection.cursor()
    sql_query = "SELECT id, title, user, content FROM posting WHERE title LIKE %s OR content LIKE %s ORDER BY id DESC"
    query_pattern = f'%{query}%'
    cursor.execute(sql_query,(query_pattern, query_pattern))
    search_results = cursor.fetchall()
    search_results_str = json.dumps(search_results)

    #giving it a default value of None
    user_file = None
    uploaded_files = os.listdir(app.config['UPLOAD_FOLDER'])
    #searching for a file that corresponds with our user
    for file in uploaded_files:
        if file.startswith(username):
            user_file = file
            break

    if user_file is None:
        filename = 'person.png'
    else:
        filename = user_file    
        
    return redirect(f'/read_stats.html?search_results={search_results_str}&filename={filename}')
